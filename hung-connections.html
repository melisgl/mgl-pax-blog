<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>Hung Connections</title>
<link type='text/css' href='style.css' rel='stylesheet'/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [['$','$']],
         processEscapes: true
       }
     });
   </script>
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
   </script>
   </head>
<body>
<div id="content-container">
<div id="toc">
<div class="menu-block"><span class="menu-block-title">me</span><ul><li><a href="http://quotenil.com">blog</a></li><li><a href="mailto:mega@retes.hu">email</a></li><li><a href="mega.gpg.asc">gpg key</a></li><li><a href="cv/cv-eng.pdf">cv (english)</a></li><li><a href="cv/cv-hun.pdf">cv (hungarian)</a></li><li><a href="http://github.com/melisgl/">git</a></li></ul></div><div class="menu-block"><span class="menu-block-title">categories</span><ul><li><a href="http://quotenil.com/blog.html">all</a></li><li><a href="http://quotenil.com/category-personal.html">personal</a></li><li><a href="http://quotenil.com/category-tech.html">tech</a></li><li><a href="http://quotenil.com/category-lisp.html">lisp</a></li><li><a href="http://quotenil.com/category-ai.html">ai</a></li></ul></div><div id="page-toc">
</div>
<div id="toc-footer"><ul><li><a href="https://github.com/melisgl/mgl-pax">[generated by MGL-PAX]</a></li></ul></div>
</div>
<div id="content">
<p><a id='x-28MGL-PAX-BLOG-3A-40HUNG-CONNECTIONS-20MGL-PAX-3ASECTION-29'></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#x-28MGL-PAX-BLOG-3A-40HUNG-CONNECTIONS-20MGL-PAX-3ASECTION-29" title="Hung Connections">&#8634;</a></span></span></p>

<h1><a href="#x-28MGL-PAX-BLOG-3A-40HUNG-CONNECTIONS-20MGL-PAX-3ASECTION-29">Hung Connections</a></h1>

<p><em>Tags</em>: <a href="category-tech.html#x-28MGL-PAX-BLOG-3A-3A-40CATEGORY-TECH-20MGL-PAX-3ASECTION-29" title="Tech">Tech</a>, <a href="blog.html#x-28MGL-PAX-BLOG-3A-3A-40BLOG-20MGL-PAX-3ASECTION-29" title="Blog">Blog</a></p>

<p><em>2011-02-27</em> -- My ISP replaced a Thomson modem with a Cisco
EPC3925 modem-router to fix the speed issue I was having. The good
news is that the connection operates near its advertised bandwidth,
the bad news is that tcp connections started to hang. It didn't take
long to <a href="http://hup.hu/node/98496" >find out</a> that this particular
router drops &quot;unused&quot; tcp connections after five minutes.</p>

<p>The fix recommended in the linked topic (namely sysctl'ing
<code>net.ipv4.tcp_keepalive_time</code> &amp; co) was mostly effective but I had
to lower the keepalive to one minute to keep my ssh sessions alive.
The trouble was that OfflineIMAP connections to the U.S. west coast
still hanged intermittently while it could work with Gmail just
fine.</p>

<p>In the end, OfflineIMAP had to be
<a href="http://permalink.gmane.org/gmane.mail.imap.offlineimap.general/2815" >patched</a>
to use the keepalive and the keepalive be lowered to 15s:</p>

<pre><code>sysctl -w net.ipv4.tcp_keepalive_time=15 \
          net.ipv4.tcp_keepalive_intvl=15 \
          net.ipv4.tcp_keepalive_probes=20
</code></pre>

<p>Oh, and always include <code>socktimeout</code> in the offlineimap config, that's
more important than keepalive unless you never have network issues.</p>
  </div>
</div>
<script>$('#page-toc').toc({'selectors': 'h1'});</script>
</body>
</html>
