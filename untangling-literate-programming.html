<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>Untangling Literate Programming</title>
<link type='text/css' href='style.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">
<script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
   <!-- Google tag (gtag.js) -->
<script async src='https://www.googletagmanager.com/gtag/js?id=G-7X64Q1D73F'></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7X64Q1D73F');
</script>
<script src='grid.js'></script>
<link rel='shortcut icon' type='image/png' href='favicon.png'>
<link rel='preconnect' href='https://fonts.googleapis.com'>
<link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
<link href='https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap' rel='stylesheet'>
<style> @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap'); </style>
<link rel='alternate' href='http://quotenil.com/blog.rss' type='application/rss+xml'/>

</head>
<body>
<div id="content-container">
<div id=toc>
 <div id=home>
  <a href=blog.html><code>(QUOTE NIL)</code></a>
 </div>
 <div id=links>
  Ramblings on <a href=ai.html>ai</a>, <a href=lisp.html>lisp</a>, <a href=tech.html>tech</a> 
  and <a href=personal.html>personal</a> topics by <a href=about-me.html>me</a>.
 </div>
</div><div id="content">
<p><a id="x-28MGL-PAX-BLOG-3A-40UNTANGLING-LITERATE-PROGRAMMING-20MGL-PAX-3ASECTION-29"></a>
<a id="MGL-PAX-BLOG:@UNTANGLING-LITERATE-PROGRAMMING%20MGL-PAX:SECTION"></a></p>

<h1><a href="untangling-literate-programming.html">Untangling Literate Programming</a></h1>

<p><span class='post-data'><em>Tags:</em> <a href="tech.html" title="tech"><code>tech</code></a>, <a href="lisp.html" title="lisp"><code>lisp</code></a>, <code>pompousness</code>,&nbsp; <em>Date:</em> 2026-02-02</span></p>

<div class='br'></div>

<h2>Classical literate programming</h2>

<p>A <a href="https://en.wikipedia.org/wiki/Literate_programming" >literate program</a> consists of interspersed narrative and
code chunks. From this, source code to be fed to the compiler is
generated by a process called <em>tangling</em>, and documentation by
<em>weaving</em>. The specifics of tangling vary, but the important point
is that this puts the human narrative first and allows complete
reordering and textual combination of chunks at the cost of
introducing an additional step into the write-compile-run cycle.</p>

<h2>The general idea</h2>

<p>It is easy to mistake this classical implementation of literate
programming for the more general idea that we want to</p>

<ol>
<li><p>present code to human readers in pedagogical order with narrative
   added, and</p></li>
<li><p>make changing code and its documentation together easy.</p></li>
</ol>

<p>The <a href="https://en.wikipedia.org/wiki/Literate_programming#Advantages" >advantages</a> of literate programming follow from
these desiderata.</p>

<h2>Untangled LP</h2>

<p>In many languages today, code order is far more flexible than in the
era of early literate programming, so the narrative order can be
approximated to some degree using docstrings and comments. Code and
its documentation are side by side, so changing them together should
also be easy. Since the normal source code now acts as the LP
source, there is no more tangling in the programming loop. This is
explored in more detail <a href="https://www.linestarve.com/blog/post/literate-programming-untangled/" >here</a>.</p>

<h2>Pros and cons</h2>

<p>Having no tangling is a great benefit, as we get to keep our usual
programming environment and tooling. On the other hand, bare-bones
untangled LP suffers from the following potential problems.</p>

<ol>
<li><p><em>Order mismatches</em>: Things like inline functions and global
   variables may need to be defined before use. So, code order tends
   to deviate from narrative order to some degree.</p></li>
<li><p><em>Reduced locality</em>: Our main tool to sync code and narrative is
   factoring out small, meaningful functions, which is just good
   programming style anyway. However, this may be undesirable for
   reasons of performance or readability. In such a case, we might
   end up with a larger function. Now, if we have only a single
   docstring for it, then it can be non-obvious which part of the
   code a sentence in the docstring refers to because of their
   distance and the presence of other parts.</p></li>
<li><p><em>No source code only view</em>: Sometimes we want to see only the
   code. In classical LP, we can look at the tangled file. In
   untangled LP, editor support for hiding the narrative is the
   obvious solution.</p></li>
<li><p><em>No generated documentation</em>: There is no more tangling nor
   weaving, but we still need another tool to generate
   documentation. Crucially, generating documentation is not in the
   main programming loop.</p></li>
</ol>

<p>In general, whether classical or untangled LP is better depends on
the severity of the above issues in the particular programming
environment.</p>

<h2>The Lisp and PAX view</h2>

<p><a href="https://github.com/melisgl/mgl-pax" >MGL-PAX</a>, a Common Lisp untangled LP solution, aims to
minimize the above problems and fill in the gaps left by dropping
tangling.</p>

<ol>
<li><p><em>Order</em></p>

<ul>
<li><p>Common Lisp is quite relaxed about the order of function
   definitions, but not so much about <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defmac.htm" title="DEFMACRO (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFMACRO</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpar.htm" title="DEFVAR (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFVAR</code></a>,
   <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpar.htm" title="DEFPARAMETER (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFPARAMETER</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defcon.htm" title="DEFCONSTANT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFCONSTANT</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_deftp.htm" title="DEFTYPE (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFTYPE</code></a> , <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defcla.htm" title="DEFCLASS (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFCLASS</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defstr.htm" title="DEFSTRUCT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFSTRUCT</code></a>,
   <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_define.htm" title="DEFINE-COMPILER-MACRO (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFINE-COMPILER-MACRO</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_set_ma.htm" title="SET-MACRO-CHARACTER (MGL-PAX:CLHS FUNCTION)"><code>SET-MACRO-CHARACTER</code></a>,
   <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_set__1.htm" title="SET-DISPATCH-MACRO-CHARACTER (MGL-PAX:CLHS FUNCTION)"><code>SET-DISPATCH-MACRO-CHARACTER</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpkg.htm" title="DEFPACKAGE (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DEFPACKAGE</code></a>. However, code order
   can for the most part follow narrative order. In practice, we
   end up with some <code>DEFVAR</code>s far from their parent
   <code>DEFSECTION</code>s (but <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_declai.htm" title="DECLAIM (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>DECLAIM</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/d_specia.htm" title="SPECIAL (MGL-PAX:CLHS DECLARATION)"><code>SPECIAL</code></a> helps).</p></li>
<li><p><code>DEFSECTION</code> controls documentation order. The references to
   Lisp definitions in <code>DEFSECTION</code> determine narrative order
   independently from the code order. This allows the few
   ordering problems to be patched over in the generated
   documentation.</p></li>
<li><p>Furthermore, because <code>DEFSECTION</code> can handle the exporting of
   symbols, we can declare the public interface piecemeal, right
   next to the relevant definitions, rather than in a monolithic
   <code>DEFPACKAGE</code></p></li>
</ul></li>
<li><p><em>Locality</em></p>

<ul>
<li><p>Lisp macros replace chunks in the rare, complex cases where a
   chunk is not a straightforward text substitution but takes
   parameters. Unlike text-based LP chunks, macros must operate
   on valid syntax trees (S-expressions), so they cannot be used
   to inject arbitrary text fragments (e.g. an unclosed
   parenthesis).</p>

<p>This constraint forces us to organize code into meaningful,
 syntactic units rather than arbitrary textual fragments,
 which results in more robust code. Within these units,
 macros allow us to reshape the syntax tree directly,
 handling scoping properly where text interpolation would
 fail.</p></li>
<li><p>PAX's <a href="https://melisgl.github.io/mgl-pax-world/mgl-pax-manual.html#MGL-PAX:NOTE%20MGL-PAX:MACRO" ><code>NOTE</code></a> is an extractable, named comment. <code>NOTE</code>
   can interleave with code within e.g. functions to minimize
   the distance between the logic and its documentation.</p></li>
<li><p>Also, PAX hooks into the development to provide easy
   navigation in the documentation tree.</p></li>
</ul></li>
<li><p><em>Source code only view:</em> PAX supports <a href="https://melisgl.github.io/mgl-pax-world/mgl-pax-manual.html#MGL-PAX:@EMACS-FUNCTIONALITY%20MGL-PAX:SECTION" >hiding</a>
   verbose documentation (sections, docstrings, comments) in the
   editor.</p></li>
<li><p><em>Generating documentation</em></p>

<ul>
<li><p>PAX extracts docstrings, <code>NOTE</code>s and combines them with
   narrative glue in <code>DEFSECTION</code>s.</p></li>
<li><p>Documentation can be <a href="https://melisgl.github.io/mgl-pax-world/mgl-pax-manual.html#MGL-PAX:@GENERATING-DOCUMENTATION%20MGL-PAX:SECTION" >generated</a> as static
   HTML/PDF files for offline reading or <a href="https://melisgl.github.io/mgl-pax-world/mgl-pax-manual.html#MGL-PAX:@BROWSING-LIVE-DOCUMENTATION%20MGL-PAX:SECTION" >browsed
   live</a> (in an Emacs buffer or via an in-built web
   server) during development.</p></li>
<li><p>LaTeX math is supported in both PDF and HTML (via
   <a href="https://melisgl.github.io/mgl-pax-world/mgl-pax-manual.html#MGL-PAX:@MATHJAX%20MGL-PAX:SECTION" >MathJax</a>, whether live or offline).</p></li>
</ul></li>
</ol>

<p>In summary, PAX accepts a minimal deviation in code/narrative order
but retains the original, interactive Lisp environment (e.g.
<a href="https://github.com/slime/slime" >SLIME</a>/<a href="https://github.com/joaotavora/sly" >Sly</a>), through which it offers optional
convenience features like extended navigation, live browsing, and
hiding documentation in code. In return, we give up easy
fine-grained control over typesetting the documentation â€” a price
well worth paying in Common Lisp.</p>
<img src="blog-files/die.png" alt="end-of-post" />
  </div>
</div>
<script>$('#page-toc').toc({'selectors': ''});</script>
</body>
</html>
